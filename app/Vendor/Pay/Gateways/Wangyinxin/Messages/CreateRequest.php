<?php
/**
 * Created by PhpStorm.
 * User: win7
 * Date: 2018/1/2
 * Time: 21:24
 */

namespace App\Vendor\Pay\Gateways\Wangyinxin\Messages;


use App\Vendor\Pay\Gateways\Common\Messages\AbstractRequest;
use App\Vendor\Pay\Gateways\Common\Messages\RequestMethod;

class CreateRequest extends AbstractRequest
{
    public $is_redirect = true;

    public $method = RequestMethod::FORM_POST;

    public $parameters = [
        'MerNo',     //商户编号
        'BillNo',     //
        'Amount',
        'Currency',
        'PayType',
        'ReturnURL',
        'NotifyURL',
        'GoodsSubject',
        'GoodsDescription'
    ];

    public function generateSignature()
    {
        $stringA = $this->MerNo . $this->BillNo . $this-> Currency . $this->Amount .
            $this->ReturnURL . $this->NotifyURL. $this->model->carrierPayChannel->bindedThirdPartGateway->private_key;
        return md5($stringA);
    }

    public function sendData($data)
    {
        $data['Md5info'] = $this->generateSignature();
        return parent::sendData($data); // TODO: Change the autogenerated stub
    }

}