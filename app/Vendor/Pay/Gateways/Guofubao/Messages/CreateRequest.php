<?php
/**
 * Created by PhpStorm.
 * User: Administrator
 * Date: 2017/12/31
 * Time: 23:22
 */
namespace App\Vendor\Pay\Gateways\Guofubao\Messages;

use App\Vendor\Pay\Gateways\Common\Messages\AbstractRequest;
use App\Vendor\Pay\Gateways\Common\Messages\RequestMethod;
use Carbon\Carbon;

class CreateRequest extends AbstractRequest
{
    use GenerateSignature;

    public $method = RequestMethod::FORM_POST;

    public $is_redirect = true;

    public $formsubmit = true;

    public $parameters = [
        'version',
        'charset',
        'language',
        'signType',
        'tranCode', // 交易代码
        'merchantID',
        'merOrderNum',
        'tranAmt', // 交易金额
        'currencyType',
        'frontMerUrl', // 前端返回地址
        'backgroundMerUrl', // 后端通知地址
        'tranDateTime',
        'virCardNoIn', // 本域指卖家在国付宝平台开设的国付宝账户号
        'tranIP',
        'gopayOutOrderId',
        'bankCode',
        'userType',
        'signValue'
    ];

    public function transTime()
    {
        return Carbon::now()->format('Ymdhis');
    }

    public function transIp()
    {
        return $_SERVER["REMOTE_ADDR"];
    }

    public function payOutOrderId()
    {
        return str_replace("ply_", '', $this->model->pay_order_number);
    }

    public function sendData($data)
    {
        // dd($data);
        $data['signValue'] = $this->generateSignature();
        
        return parent::sendData($data); // TODO: Change the autogenerated stub
    }
}